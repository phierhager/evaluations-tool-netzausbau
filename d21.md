# Deliverable D2.1: GEMS System Specification & Benchmarks

**Project:** PhyLFlex (Physics-based Learning Energy Management)
**Work Package:** AP 2.1 (Konzeptionierung eines netzdienlichen GEMS)
**Responsible:** HAW Landshut (HAWL)
**Associated Partners:** TUM, ÜZW, SAG
**Version:** 1.0 (Final Specification)

---

## 1. Executive Summary
This document defines the technical architecture, functional requirements, and evaluation benchmarks for the Building Energy Management Systems (GEMS) to be developed in PhyLFlex. It acts as the "Lastenheft" (Requirements Specification) for the **Convex GEMS** (AP 4), **RL-based GEMS** (AP 5), and **Physics-inspired GEMS** (AP 8).

The objective is to design a modular system that optimizes local energy flows—integrating PV, Batteries, EVs, and Heat Pumps—while strictly adhering to grid constraints (§14a EnWG) and minimizing costs. The system is designed as an **Edge-Computing Solution** to ensure operation without transmitting high-resolution load data to the Distribution System Operator (DSO)[cite: 87, 88].

---

## 2. System Architecture

To enable the comparison of different algorithmic approaches (Mathematical Solver vs. Reinforcement Learning), the GEMS architecture is strictly modularized.

### 2.1 Functional Modules
1.  **Data Handler (Input Layer):**
    * **Interfaces:** Aggregates real-time data from Smart Meter Gateways (iMSys), PV Inverters, and Heat Pump controllers.
    * **Privacy Filter:** Ensures granular user behavior data remains local. Only aggregated flexibility potentials are exposed to external actors if required[cite: 87].
2.  **Optimizer Core (The "Plug-in Slot"):**
    * **Function:** Hosts the decision-making logic. This slot will be filled by the **Convex Solver** (AP 4), **RL Agent** (AP 5), or **Physics-Inspired Model** (AP 8).
    * **Objective:** Minimize total cost ($C_{total}$) while maintaining user comfort (Temperature, SoC).
3.  **Actuator Bridge (Output Layer):**
    * **Function:** Translates optimized schedules into specific control protocols (e.g., Modbus TCP, EEBUS, OCPP) for controllable assets (*SteuVE*).
    * **Safety Override:** Implements a high-priority logic to immediately throttle loads upon receiving a **§14a EnWG dimming signal** from the DSO[cite: 206].

### 2.2 Hardware Reference Platform
To ensure economic viability and scalability, the algorithms must be benchmarked on resource-constrained hardware[cite: 384].

* **Target Device:** Raspberry Pi 4 (or equivalent industrial Edge-Controller like Arduino Portenta).
* **Constraint:** The optimization cycle (inference) must complete within the control interval (typically 15 minutes) using limited RAM (< 2 GB) and low power consumption.

### 3. Benchmark KPIs & Measurement Methodology

To satisfy the project requirements (AP 2.1), we define two categories of metrics.

#### 3.1 Category A: Hardware & Efficiency (External Benchmarks)

*These metrics cannot be measured by the Grid Evaluation Tool. They must be measured **once** by the developers (AP 4/5/8) on the target hardware (Raspberry Pi/Arduino) and reported as Metadata.*

| KPI | Benchmark Target | **Method of Measurement** |
| --- | --- | --- |
| **Runtime Efficiency** | < 60 seconds (24h schedule) | **Stopwatch/Logs:** Developer runs the algorithm on a physical Raspberry Pi 4 and records the execution time. |
| **Energy Consumption** | < 5 Watts | **Power Meter:** Developer measures the physical power draw of the Raspberry Pi during the calculation. |
| **Memory Footprint** | < 512 MB RAM | **System Monitor:** Measured via OS tools (e.g., `htop`) during execution. |

#### 3.2 Category B: Grid & Economic Impact (Tool Metrics)

*These metrics are calculated dynamically by the **Grid Evaluation Tool (AP 2.2)** based on the generated load profiles (CSV).*

| KPI | Target | **Method of Measurement** | Source |
| --- | --- | --- | --- |
| **Grid Expansion Costs (CAPEX)** | Minimize (€0 if possible) | **Tool Calculation:** Evaluates if Voltage < 207V or Trafo Load > 100%. If yes, adds cost of new cables/trafo. |
| **Operational Costs (OPEX)** | Maximize Savings | **Tool Calculation:** Sum of `(Import * Price) - (Export * Feed-in)`. |
| **§14a Intervention Count** | 0 Events (Ideal) | **Tool Counter:** Counts how many timesteps the tool was forced to dim `p_flexible_steuve_kw` to protect the grid. |
| **Comfort Violation Rate** | 0% | **Tool Counter:** Percentage of timesteps where `is_comfort_met == 0` in the CSV input. |

#### 3.3 Translation of Academic Metrics to Project KPIs

To ensure scientific rigor (D2.2) aligns with practical project goals (D2.3), the following mapping is established:

| **Scientific Metric (D2.2)** | **Translation Logic** | **Project KPI (D2.1 / Tool)** |
| --- | --- | --- |
| **Peak-to-Average Ratio (PAR)** | High peaks  Overloaded Transformers  New Hardware needed. | **Grid Expansion Costs (CAPEX)** |
| **Self-Consumption Rate (SCR)** | Using own PV reduces grid import. | **Annual Electricity Cost (OPEX)** |
| **Predicted Mean Vote (PMV)** | Mathematical deviation from thermal comfort standards. | **Comfort Violation Rate (`is_comfort_met` = 0)** |
| **Ramping Rate ()** | Fast changes cause instability/flickering. | **§14a Intervention Count** |


## 4. Definition of Test Cases (Szenarien)

To enable a comparable Cost-Benefit Analysis (AP 2.1) and later validation in the CoSES Laboratory (AP 9), four standardized operational scenarios are defined[cite: 382].

### **Test Case A: The "Island" Optimizer (Baseline)**
* **Description:** Single building optimization focused on self-consumption. No communication with the grid or neighbors.
* **Goal:** Establish a baseline for individual building efficiency.
* **Constraint:** No external coordination.

### **Test Case B: Peer-to-Peer (P2P) Community**
* **Description:** Buildings are logically connected and can exchange energy. Excess PV generation from House A is virtually shared with House B.
* **Goal:** Evaluate the benefit of local balancing without extensive data sharing.
* **Data:** Limited to smart meter data exchange.

### **Test Case C: Best-Case Data Infrastructure**
* **Description:** A theoretical optimum where comprehensive real-time data and forecasts are shared between all GEMS in a cluster.
* **Goal:** Determine the maximum technical potential of the cluster to benchmark other approaches against.

### **Test Case D: Grid-Constrained Operation (§14a)**
* **Description:** The DSO imposes specific load limits (e.g., max. 4.2 kW import) to ensure grid stability[cite: 381].
* **Challenge:** The GEMS must prioritize inflexible loads (lights/cooking) and dynamically throttle flexible assets (EVs/Heat Pumps) to respect the limit.

---

You are absolutely right. I made a logical error in the previous draft.

**Critical Assessment:**
Deliverable D2.1 is the **Requirements & Benchmarks Specification**.

* In Section 3, we defined "Grid Expansion Costs" and "Intervention Counts" as the KPIs.
* Therefore, the **Interface Specification (Section 5)** in D2.1 must define **how these KPIs are reported**.
* The previous draft described the *Input* to the grid simulation (Power). That was wrong.
* **Correction:** D2.1 must define the **Output** of the grid simulation (Reinforcement/Curtailment), because **this is the data structure that validates if the GEMS meets the requirements.**

Here is the corrected **Section 5** for **Deliverable D2.1**. It now strictly defines the **"Grid Result Schema"** (Reinforcement & Curtailment) as the official validation interface.

---


## 5. Interface Specification for Validation (The "Evaluation Schema")

To validate the developed GEMS (AP 4, 5, 8) against the benchmarks defined in Section 3, a standardized **Result Interface** is required.

The GEMS itself does not produce this data; the **Grid Simulation (AP 3)** produces it based on the GEMS behavior. This section defines the strict data format that the Grid Simulation must export to enable the Cost-Benefit Analysis in the Evaluation Tool (AP 2.2).

### 5.1 The Validation Pipeline

1. **GEMS Agents (AP 4/5/8)** generate load profiles.
2. **Grid Simulation (AP 3)** runs physical power flow analysis on these profiles.
3. **Result Export:** The Simulation aggregates the physical state into the **"Evaluation Schema"** defined below.
4. **Cost Calculation:** The Evaluation Tool (AP 2.2) reads this schema to calculate CAPEX/OPEX.

### 5.2 Metadata Header (Simulation Context)

Every validation run must begin with a Metadata Header to define the test context (Scenario and Hardware).

```csv
# METADATA_START
# test_case_id: SCENARIO_D_GRID_CONSTRAINED
# grid_topology: RURAL_VILLAGE_01
# agent_hardware_platform: Raspberry Pi 4
# agent_avg_inference_time_ms: 45
# METADATA_END

```

### 5.3 Time-Series Data Schema (Evaluation Output)

The Grid Simulation must export the **aggregated physical consequences** of the GEMS behavior using the following schema. This format directly maps physical violations to the Cost KPIs defined in Section 3.2.

```csv
timestamp, grid_status, reinforcement_cable_km, reinforcement_trafo_kva, curtailment_kwh
2025-01-01 00:00, OK, 0.0, 0, 0.0
2025-01-01 18:00, CRITICAL, 2.5, 0, 15.0
2025-01-01 19:00, CRITICAL, 12.0, 250, 40.0

```

**Column Definitions:**

1. **`timestamp`**: ISO 8601 format (15-min resolution).
2. **`grid_status`**:
* **Definition:** Categorical Status (`OK`, `WARNING`, `CRITICAL`).
* **Purpose:** Quick diagnostic flag. `CRITICAL` indicates a voltage violation (< 207V) or overload that requires hardware reinforcement.


3. **`reinforcement_cable_km`** (Maps to KPI: Grid Expansion Costs):
* **Definition:** The total length (km) of cable sections that violated thermal or voltage limits and require physical reinforcement (e.g., parallel cabling).
* **Evaluation Logic:** If `> 0`, the GEMS failed to stabilize the grid. The tool calculates `km * Cost/km` (Virtual CAPEX).


4. **`reinforcement_trafo_kva`** (Maps to KPI: Grid Expansion Costs):
* **Definition:** The missing transformer capacity (kVA) if the load exceeded 100% of the rated power.
* **Evaluation Logic:** If `> 0`, the tool triggers a "Virtual Transformer Upgrade" cost (Fixed CAPEX).


5. **`curtailment_kwh`** (Maps to KPI: §14a Intervention Count):
* **Definition:** The total energy (kWh) that the grid simulation was forced to suppress (dim) via §14a EnWG to keep the grid stable.
* **Evaluation Logic:** If `> 0`, the GEMS required DSO intervention. The tool calculates `kWh * Penalty_€` (Intervention OPEX).

